---
title: 'Colbrush: 웹 접근성을 위한 색맹 대응 테마 라이브러리 개발기'
date: '2025-11-20'
desc: 'CIE Lab 색공간을 활용한 자동 테마 생성 알고리즘과 라이브러리 배포 과정에서 겪은 SVG, Tailwind 충돌 문제 해결 과정'
tags: ['Troubleshooting', 'Open Source', 'Accessibility', 'React']
slug: 'colbrush-dev-story'
---

## 1. 프로젝트 개요: 왜 Colbrush인가?

웹 접근성(A11y)은 더 이상 선택이 아닌 필수입니다. 하지만 실제 현업에서 디자이너와 개발자가 색각 이상자(Color Blindness)를 위한 별도의 고대비 테마를 일일이 제작하는 것은 많은 리소스가 드는 일입니다.

> "기존 코드를 거의 건드리지 않고, 명령어 한 줄로 색맹 대응 테마를 만들어줄 순 없을까?"

이 질문에서 출발하여 Colbrush를 개발하게 되었습니다. Colbrush는 기존 CSS 변수를 파싱하여 적색맹(Protanopia), 녹색맹(Deuteranopia), 청색맹(Tritanopia)에 맞는 최적의 색상을 자동으로 생성해주는 오픈소스 라이브러리입니다.

## 2. 핵심 기술: RGB를 넘어 CIE Lab으로

초기에는 RGB 색공간에서 단순히 R, G, B 채널 값을 조절하여 색상을 변환하려 했습니다. 하지만 곧 치명적인 한계에 부딪혔습니다. RGB는 인간의 눈이 인지하는 '밝기(Lightness)'와 '색상(Hue)'이 분리되어 있지 않아, 색을 변환하면 명도가 깨져버리는 문제가 있었습니다. 디자인의 위계(Hierarchy)가 무너지는 것이죠.

이를 해결하기 위해 CIE Lab 색공간을 도입했습니다.

-   L (Lightness): 명도
-   a: Red - Green 축
-   b: Yellow - Blue 축

Lab 색공간을 활용하여 명도(L)는 원본 디자인과 동일하게 유지하면서, 색각 이상자가 인지하기 어려운 색상 축(a, b)만 회전시키거나 보정하는 알고리즘을 구현했습니다. 그 결과, 원본 디자인의 느낌을 해치지 않으면서도 구분 가능한 테마를 생성할 수 있었습니다.

## 3. 트러블 슈팅 1: SVG 아이콘이 사라진다?

라이브러리 내 ThemeSwitcher 컴포넌트에 들어갈 아이콘을 개발하는 과정에서 문제가 발생했습니다. React 환경에서 SVG를 직접 import해서 쓸 때, 빌드 환경에 따라 아이콘이 깨지거나 렌더링되지 않는 현상이었습니다.

### 문제 상황

> -   `viewBox` 속성이 빌드 시 자동으로 삭제되어 아이콘 비율이 깨짐
> -   `?react` import 방식이 Vite 버전이나 플러그인 설정에 따라 일관성 없게 동작함

### 원인 분석

SVGO(SVG Optimizer)의 기본 설정이 `removeViewBox: true`로 되어 있어 반응형 처리에 필수적인 속성을 날려버리는 것이 원인이었습니다. 또한, 런타임에 SVG를 컴포넌트로 변환하는 것은 불안정했습니다.

### 해결: 빌드 타임 변환 (Pre-conversion)

런타임 변환 대신, 빌드 단계에서 아예 SVG를 `.tsx` 컴포넌트로 변환해버리는 방식을 택했습니다. @svgr/cli를 도입하고 설정을 커스텀했습니다.

```cjs
// svgr.config.cjs
module.exports = {
    typescript: true,
    svgo: true,
    svgoConfig: {
        plugins: [
            // viewBox 삭제 방지
            {
                name: 'preset-default',
                params: { overrides: { removeViewBox: false } },
            },
            { name: 'removeDimensions', active: true }, // width/height 제거 (CSS로 제어)
        ],
    },
};
```

이렇게 설정한 뒤 `npm run build:icons` 스크립트를 통해 아이콘을 미리 컴포넌트화하여 안정성을 확보했습니다.

## 4. 트러블 슈팅 2: Tailwind CSS 미디어 쿼리 충돌

라이브러리를 배포하고 사용자 피드백을 받던 중, **"Colbrush를 설치하면 기존 프로젝트의 반응형 스타일(sm, md, lg)이 먹통이 됩니다."** 라는 치명적인 이슈가 접수되었습니다.

원인 분석

라이브러리의 스타일 파일인 `colbrush/styles.css` 내부에서 `@import 'tailwindcss'`를 호출하고 있었던 것이 화근이었습니다.

사용자 프로젝트에도 이미 Tailwind가 설정되어 있는데, 라이브러리에서 또다시 Tailwind Base 스타일을 불러오면서 **CSS Cascade Layer(우선순위)** 가 꼬여버린 것입니다. 이로 인해 미디어 쿼리의 우선순위가 뒤로 밀려버렸습니다.

해결 방법

라이브러리 빌드 아키텍처를 변경했습니다.

라이브러리 내부 스타일에서 Tailwind 의존성을 완전히 제거했습니다.

`colbrush/styles.css`는 오직 우리가 생성한 CSS Variables와 최소한의 레이아웃 스타일만 포함하도록 경량화했습니다.

결과적으로 사용자의 환경과 충돌하지 않는 "Framework Agnostic"한 라이브러리가 되었습니다.

## 5. 성과 및 배운 점

이 프로젝트를 통해 단순히 기능을 구현하는 것을 넘어, **다른 개발자가 쓰기 편한 라이브러리란 무엇인가?** 를 깊이 고민하게 되었습니다.

DX(Developer Experience): 복잡한 설정 없이 npx 명령어 한 줄로 실행되도록 CLI를 설계했습니다.

문서화: README뿐만 아니라 랜딩 페이지를 별도로 제작하여 접근성을 높였습니다.

성과: 이러한 노력을 인정받아 2025 오픈소스 개발자대회에서 동상을 수상했고, NPM 다운로드 2,300회를 달성할 수 있었습니다.

앞으로도 "모두를 위한 웹"을 만들기 위해 기술적 도전을 멈추지 않겠습니다.
